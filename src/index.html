<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <link rel="icon" href="./favicon.ico" />
    <title>Frontify Finder</title>
    <style>
        body {
            padding: 40px;
        }

        #FinderFrame {
            display: none;
            width: 800px;
            height: 600px;
            position: fixed;
            top: 50%;
            left: 50%;
            background-color: transparent;
            z-index: 1002;
            margin-left: -400px;
            margin-top: -300px;
            box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
<div>
    <p>Frontify Finder</p>
    <p>
        <button id="finder">Finder</button>
        <button id="refresh">Refresh</button>
        <button id="revoke">Revoke</button>
    </p>
    <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore
        magna aliqua. Ultrices tincidunt arcu non sodales neque sodales ut etiam. Libero volutpat sed cras ornare arcu.
        Ornare suspendisse sed nisi lacus sed viverra tellus in. Pretium viverra suspendisse potenti nullam ac tortor
        vitae purus faucibus. Et malesuada fames ac turpis egestas. Justo nec ultrices dui sapien eget mi proin sed.
        Phasellus faucibus scelerisque eleifend donec pretium vulputate. Donec pretium vulputate sapien nec sagittis
        aliquam. Etiam sit amet nisl purus in mollis nunc. Faucibus purus in massa tempor nec. Eu tincidunt tortor
        aliquam nulla facilisi. Eget mi proin sed libero enim sed faucibus turpis. Odio aenean sed adipiscing diam donec
        adipiscing tristique. In aliquam sem fringilla ut morbi tincidunt augue interdum velit. Lorem donec massa sapien
        faucibus. Nulla aliquet porttitor lacus luctus accumsan.
    </p>
    <p>
        Pharetra vel turpis nunc eget lorem dolor sed viverra ipsum. Consectetur libero id faucibus nisl tincidunt eget
        nullam non. Pretium viverra suspendisse potenti nullam ac tortor vitae. Quam viverra orci sagittis eu volutpat
        odio. Vitae auctor eu augue ut lectus arcu bibendum. Vel turpis nunc eget lorem dolor sed viverra ipsum nunc.
        Volutpat blandit aliquam etiam erat velit scelerisque in. Dignissim suspendisse in est ante in nibh mauris
        cursus. Vitae nunc sed velit dignissim sodales ut eu. In arcu cursus euismod quis viverra nibh cras. Urna neque
        viverra justo nec ultrices dui sapien eget mi. Sed nisi lacus sed viverra. Auctor urna nunc id cursus metus
        aliquam. Vehicula ipsum a arcu cursus vitae. Aliquet enim tortor at auctor urna nunc id.
    </p>
    <p>
        Pharetra convallis posuere morbi leo urna molestie at. Ultricies integer quis auctor elit. Sed risus ultricies
        tristique nulla aliquet enim tortor at auctor. Praesent semper feugiat nibh sed pulvinar proin. Donec ultrices
        tincidunt arcu non sodales neque sodales. Id nibh tortor id aliquet lectus. Et pharetra pharetra massa massa
        ultricies mi quis. In egestas erat imperdiet sed euismod nisi porta. Viverra accumsan in nisl nisi. Nulla
        aliquet enim tortor at auctor urna nunc id. Augue mauris augue neque gravida. Laoreet sit amet cursus sit amet
        dictum sit. Curabitur vitae nunc sed velit. Sit amet justo donec enim diam vulputate ut. Varius quam quisque id
        diam.
    </p>
</div>
<div id="FinderFrame"></div>
<script src="https://unpkg.com/@frontify/frontify-authenticator@latest/dist/index.js"></script>
<script src="https://unpkg.com/@frontify/frontify-finder@latest/dist/index.js"></script>
<script>
    const POPUP_CONFIG = {
        width: 800,
        height: 600,
        top: 50,
        left: 50,
        title: 'Authorize Frontify',
    };
    const AUTHORIZATION_CONFIG = {
        domain: 'weare.frontify.com',
        clientId: 'client-fvp38zpvz1pxfcwg',
        scopes: ['basic:read', 'finder:read', 'api:v1'],
    };

    let token = localStorage.getItem('FrontifyAuthenticatorToken');

    function finderAction() {
        if (token) {
            openFinder();
        } else {
            FrontifyAuthenticator.authorize(AUTHORIZATION_CONFIG, POPUP_CONFIG)
                .then((res) => {
                    if (res) {
                        localStorage.setItem('FrontifyAuthenticatorToken', JSON.stringify(res));
                        token = localStorage.getItem('FrontifyAuthenticatorToken');
                        openFinder();
                    }
                })
                .catch((err) => {
                    console.log(err);
                });
        }
    }

    function revokeAction() {
        if (!token) {
            console.log('Nothing to revoke! No token available');
            return;
        }

        FrontifyAuthenticator.revoke(JSON.parse(token))
            .then((res) => {
                if (res) {
                    localStorage.removeItem('FrontifyAuthenticatorToken');
                    token = null;
                    delete AUTHORIZATION_CONFIG.domain;
                }
            })
            .catch((error) => {
                console.log(error);
            });
    }

    function refreshAction() {
        if (!token) {
            console.log('Nothing to refresh! No token available');
            return;
        }

        FrontifyAuthenticator.refresh(JSON.parse(token))
            .then((res) => {
                if (res) {
                    localStorage.setItem('FrontifyAuthenticatorToken', JSON.stringify(res));
                    token = localStorage.getItem('FrontifyAuthenticatorToken');
                }
            })
            .catch((error) => {
                console.log(error);
            });
    }

    function openFinder() {
        FrontifyFinder.open(JSON.parse(token), {
            container: document.getElementById('FinderFrame'),
        })
            .then((assets) => {
                console.log(assets);
            })
            .catch((error) => {
                console.log(error);
            });
    }

    document.getElementById('finder').addEventListener('click', finderAction);
    document.getElementById('revoke').addEventListener('click', revokeAction);
    document.getElementById('refresh').addEventListener('click', refreshAction);
</script>

</body>
</html>